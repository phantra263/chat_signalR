<!-- chat 1 vs 1 -->
<div class="wrap-content" *ngIf="!checkIsEmpty(userChatWith) && idParam">
  <div class="header">
    <div class="user">
      <img src="./assets/images/arrow-left.png" alt="" class="icon-back" routerLink="/chat" *ngIf="idParam">
      <div class="avatar" [ngStyle]="{'background-color' : userChatWith.AvatarBgColor}">
        {{userChatWith.Nickname[0]}}
      </div>
      <div class="infor">
        <h5>{{userChatWith.Nickname}}</h5>
        <p>{{userChatWith.IsOnline ? 'Online' : 'Offline'}}</p>
      </div>
    </div>
    <div class="control">
      <img src="./assets/images/icon-phone.png" alt="">
      <img src="./assets/images/icon-videocall.png" alt="">
    </div>
  </div>
  <div class="chat-history" #messageContainer (scroll)="onChatScroll($event)">
    <div class="mess-empty" *ngIf="listMessage.length === 0 && !isLoading">
      <div class="avatar" [ngStyle]="{'background-color' : userChatWith.AvatarBgColor}">
        {{userChatWith.Nickname[0]}}
      </div>
      <h3>
        {{userChatWith.Nickname}}
      </h3>
      <p>Hãy bắt đầu nhắn tin với <span style="font-weight: bold;">{{userChatWith.Nickname}}</span> nào!</p>
    </div>

    <ul>
      <li *ngFor="let data of listMessage; let i = index"
        [ngClass]="!(i > 0 && this.checkShowAvatar(listMessage[i - 1], data)) ? 'mt-0' : ''">
        <div class="wrap-message" [ngClass]="currUser.Id === data.senderId ? 'my-message' : ''">
          <figure *ngIf="currUser.Id !== data.senderId"
            [ngClass]="(i === 0 || i > 0 && checkShowAvatar(listMessage[i - 1], data)) ? '' : 'hidden'"
            [ngStyle]="{'background-color' : userChatWith.AvatarBgColor}" [title]="userChatWith.Nickname">
            {{userChatWith.Nickname[0]}}
          </figure>
          <p class="message">
            {{data.content}}
          </p>
          <span class="message-data-time time-default">{{ data.created | TimeMessFormat }}</span>
        </div>
      </li>
    </ul>
  </div>
  <div class="wrap-input-chat">
    <div class="input-chat">
      <textarea [(ngModel)]="inputChat" rows="1" (keydown.enter)="onEnterKeyPressed($event)" placeholder="Type your message here..."></textarea>
      <!-- <span class="pick-emoji"
        (click)="toggled = !toggled"
        [(emojiPickerIf)]="toggled"
        [emojiPickerDirection]="'left'"
        (emojiPickerSelect)="handleSelection($event)">
        <img src="./assets/images/icon-face.png" alt="">
      </span> -->
    </div>
    <button [disabled]="!inputChat.trim() ? true : false" (click)="sendMess()">
      Send
    </button>
  </div>
</div>

<!-- chat room -->
<div class="wrap-content" *ngIf="!checkIsEmpty(roomChat) && roomIdParam">
  <div class="header">
    <div class="user">
      <img src="./assets/images/arrow-left.png" alt="" class="icon-back" routerLink="/chat" *ngIf="roomIdParam">
      <div class="avatar" [ngStyle]="{'background-color' : 'grey'}">
        {{roomChat.Name[0]}}
      </div>
      <div class="infor">
        <h5>{{roomChat.Name}}</h5>
      </div>
    </div>
    <div class="control">
      <img src="./assets/images/icon-phone.png" alt="">
      <img src="./assets/images/icon-videocall.png" alt="">
    </div>
  </div>
  <div class="chat-history" #messageContainer (scroll)="onChatScroll($event)">
    <div class="mess-empty" *ngIf="listMessage.length === 0 && !isLoading">
      <div class="avatar">
        <img src="https://robohash.org/2" alt="">
      </div>
      <h3>
        {{roomChat.name}}
      </h3>
      <p>Hãy bắt đầu nhắn tin trong phòng chat!</p>
    </div>

    <ul>
      <li *ngFor="let data of listMessage; let i = index"
        [ngClass]="!(data.isNoti && i > 0 && this.checkShowAvatar(listMessage[i - 1], data)) ? 'mt-0' : ''">
        <!-- tin nhắn bình thường -->
        <div class="wrap-message-room" *ngIf="!data.IsNoti">
          <div class="avatar-room" *ngIf="(i === 0 || i > 0 && checkShowAvatarInRoom(listMessage[i - 1], data))"
            [ngClass]="currUser.Id === data.SenderId ? 'my-avatar' : ''"
            [title]="data.AnonymousName">
            <img [src]="'https://robohash.org/' + data.AvatarId" alt="">
            <span>{{data.AnonymousName}}</span>
          </div>
          <div class="detail-mess" 
            [ngClass]="currUser.Id === data.SenderId ? 'my-message' : ''">
            <p class="message">
              {{data.Content}}
            </p>
            <span class="message-data-time">{{ data.Created | TimeMessFormat }}</span>
          </div>
        </div>

        <!-- thông báo khi có thành viên mới vào nhóm -->
        <div *ngIf="data.IsNoti" class="noti-join-room">
          <img [src]="'https://robohash.org/' + data.AvatarId" alt="">
          <p>
            <b style="font-weight: bold; margin-right: 5px;">{{data.AnonymousName}}</b>vừa vào phòng!
          </p>
        </div>
      </li>
    </ul>
  </div>
  <div class="wrap-input-chat">
    <div class="input-chat">
      <textarea [(ngModel)]="inputChatRoom" rows="1" (keydown.enter)="onEnterKeyPressed($event)" placeholder="Type your message here..."></textarea>
    </div>
    <button [disabled]="!inputChatRoom.trim() ? true : false" (click)="sendMessRoom()">
      Send
    </button>
  </div>
</div>

<div *ngIf="isLoading">
  <div class="container-loading">
    <div class="ball"></div>
    <div class="ball"></div>
    <div class="ball"></div>
    <div class="ball"></div>
  </div>
</div>